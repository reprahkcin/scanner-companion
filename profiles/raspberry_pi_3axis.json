{
  "name": "raspberry_pi_3axis",
  "description": "MKI Scanner: 3-axis with rotation platform, linear focus rail, and vertical tilt",
  "version": "2.0",
  
  "axes": [
    {
      "name": "M1",
      "label": "Rotation Platform",
      "axis_type": "rotary",
      "units": "deg",
      "min_limit": 0.0,
      "max_limit": 360.0,
      "home_position": 0.0,
      "steps_per_unit": 17.7778,
      "max_velocity": 10.0,
      "acceleration": 50.0,
      "controller_axis": "",
      "motor_index": 1,
      "inverted": false,
      "has_home_switch": false,
      "home_direction": -1,
      "role": "turntable"
    },
    {
      "name": "M2",
      "label": "Focus Rail",
      "axis_type": "linear",
      "units": "mm",
      "min_limit": 0.0,
      "max_limit": 150.0,
      "home_position": 0.0,
      "steps_per_unit": 1281.21,
      "max_velocity": 10.0,
      "acceleration": 50.0,
      "controller_axis": "",
      "motor_index": 2,
      "inverted": false,
      "has_home_switch": true,
      "home_direction": -1,
      "role": "focus_rail"
    },
    {
      "name": "M3",
      "label": "Vertical Tilt",
      "axis_type": "rotary",
      "units": "deg",
      "min_limit": -45.0,
      "max_limit": 45.0,
      "home_position": 0.0,
      "steps_per_unit": 88.8889,
      "max_velocity": 10.0,
      "acceleration": 50.0,
      "controller_axis": "",
      "motor_index": 3,
      "inverted": false,
      "has_home_switch": false,
      "home_direction": -1,
      "role": "tilt"
    }
  ],
  
  "controllers": [
    {
      "controller_type": "arduino_serial",
      "name": "arduino",
      "port": "/dev/ttyACM0",
      "baudrate": 115200,
      "settings": {
        "command_timeout": 30.0,
        "position_query_enabled": true
      }
    }
  ],
  
  "axis_controller_map": {
    "M1": "arduino",
    "M2": "arduino",
    "M3": "arduino"
  },
  
  "scene_geometry": {
    "coordinate_system": "Z-up, right-handed",
    "description": "Camera on X-axis rail pointing at specimen. Specimen rotates on Z-axis turntable. Turntable tilts on Y-axis.",
    
    "specimen": {
      "position": [0, 0, 0],
      "mounted_on": "M1",
      "notes": "Specimen fixed to turntable platform. Remains at origin during rotation. Tilts with M3 but pivot designed to keep specimen centered."
    },
    
    "axes_geometry": {
      "M1": {
        "role": "turntable",
        "motion_type": "rotation",
        "axis_vector": [0, 0, 1],
        "pivot_point": [0, 0, -10],
        "positive_direction": "CCW when viewed from +Z (above)",
        "affects": "specimen",
        "notes": "Turntable motor beneath specimen platform"
      },
      "M2": {
        "role": "focus_rail",
        "motion_type": "linear",
        "axis_vector": [1, 0, 0],
        "home_position": [10, 0, 0],
        "travel_range": [10, 160],
        "positive_direction": "Away from specimen (+X)",
        "affects": "camera",
        "notes": "Camera slides on rail. Home (0mm) is closest to specimen at X=10mm from origin."
      },
      "M3": {
        "role": "tilt",
        "motion_type": "rotation",
        "axis_vector": [0, 1, 0],
        "pivot_point": [0, 0, 0],
        "positive_direction": "Tips specimen toward camera (top tilts toward +X)",
        "affects": "turntable",
        "notes": "Tilt motor rotates entire turntable assembly. Pivot designed so specimen stays at origin."
      }
    },
    
    "camera": {
      "mounted_on": "M2",
      "looks_at": "specimen",
      "home_position": [10, 0, 0],
      "home_orientation": [-1, 0, 0],
      "notes": "Camera faces -X direction (toward origin). Position changes with M2 (focus rail)."
    }
  },
  
  "power_relay": {
    "enabled": true,
    "controller": "arduino",
    "pin": "A0",
    "active_low": true
  },
  
  "scan_defaults": {
    "perspectives": 72,
    "focus_slices": 5,
    "settle_delay": 1.0,
    "scan_modes": ["ring", "spherical"],
    "default_scan_mode": "ring",
    "spherical_settings": {
      "elevation_min": -30,
      "elevation_max": 30,
      "elevation_steps": 5
    }
  },
  
  "pose_calculation": {
    "method": "specimen_rotating",
    "notes": "Turntable rotates specimen CCW, equivalent to camera orbiting CW. Pose calculated as: 1) Camera at focus distance on +X axis, 2) Apply tilt (Y rotation), 3) Apply inverse turntable angle (camera orbits opposite to specimen rotation)."
  }
}
